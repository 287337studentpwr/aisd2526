#include <iostream>
#include <vector>
#include <cmath>

long long COMP = 0; // porównania elementów
long long ASS  = 0; // przypisania elementów

namespace vectors_1{
    std::vector<int> A7 = {7, 4, 5, 4, 2, 1, 9};
    // nie posortowana Lista wielkości n=7
    std::vector<int> A15 = {91, 43, 77, 13, 58, 62, 71, 26, 80, 41, 59, 2, 97, 34, 15};
    // nie posortowana Lista wielkości n=15
    std::vector<int> A100 = {864, 394, 776, 911, 430, 41, 265, 988, 523, 497,
                             414, 940, 802, 849, 310, 991, 488, 366, 597, 913,
                             929, 223, 516, 142, 289, 144, 774, 98, 634, 819,
                             257, 544, 961, 822, 437, 112, 82, 896, 340, 139,
                             952, 580, 360, 553, 517, 189, 121, 353, 923, 960,
                             995, 422, 598, 183, 454, 230, 37, 282, 394, 763,
                             89, 567, 912, 531, 604, 153, 293, 286, 105, 893,
                             674, 721, 957, 95, 818, 763, 947, 912, 56, 764,
                             632, 426, 900, 828, 845, 56, 912, 620, 456, 120,
                             259, 43, 699, 278, 684, 711, 265, 814, 694, 732};
    // nie posortowana Lista wielkości n=100
    std::vector<int> A1000 ={864, 394, 776, 911, 430, 41, 265, 988, 523, 497, 414, 940, 802, 849, 310, 991, 488, 366, 597, 913, 929, 223, 516, 142, 289, 144, 774, 98, 634, 819,
                             257, 544, 961, 822, 437, 112, 82, 896, 340, 139, 952, 580, 360, 553, 517, 189, 121, 353, 923, 960, 995, 422, 598, 183, 454, 230, 37, 282, 394, 763,
                             89, 567, 912, 531, 604, 153, 293, 286, 105, 893, 674, 721, 957, 95, 818, 763, 947, 912, 56, 764, 632, 426, 900, 828, 845, 56, 912, 620, 456, 120,
                             259, 43, 699, 278, 684, 711, 265, 814, 694, 732, 462, 1, 750, 745, 629, 567, 212, 936, 110, 561, 77, 785, 947, 546, 738, 998, 955, 542, 163, 702,
                             260, 827, 641, 456, 791, 418, 287, 904, 897, 540, 274, 506, 891, 787, 442, 88, 984, 563, 590, 245, 274, 439, 735, 888, 501, 855, 567, 923, 792, 217,
                             928, 272, 925, 369, 60, 365, 419, 515, 74, 492, 621, 438, 972, 36, 263, 771, 587, 606, 255, 196, 20, 691, 155, 672, 478, 856, 757, 380, 563, 964,
                             136, 260, 815, 945, 776, 197, 482, 212, 904, 213, 230, 701, 549, 372, 39, 516, 153, 545, 819, 292, 51, 180, 525, 279, 912, 436, 479, 985, 941, 641,
                             632, 370, 111, 390, 675, 385, 77, 452, 306, 374, 450, 345, 165, 826, 968, 113, 280, 650, 709, 455, 431, 770, 995, 862, 733, 237, 375, 742, 70, 113,
                             922, 936, 871, 284, 686, 776, 361, 658, 441, 509, 75, 778, 803, 950, 766, 236, 947, 273, 112, 442, 253, 326, 479, 160, 710, 233, 761, 953, 331, 610,
                             463, 386, 67, 761, 957, 934, 500, 588, 542, 633, 111, 950, 989, 232, 458, 474, 875, 764, 396, 213, 604, 355, 961, 481, 991, 510, 764, 637, 255, 812,
                             138, 964, 338, 711, 497, 879, 604, 937, 594, 828, 495, 671, 394, 343, 918, 312, 966, 429, 616, 833, 468, 424, 620, 203, 667, 44, 806, 162, 911, 712,
                             951, 365, 357, 1, 92, 850, 218, 710, 214, 797, 803, 671, 265, 264, 857, 214, 264, 998, 33, 103, 792, 361, 182, 849, 16, 241, 753, 856, 81, 764,
                             427, 737, 518, 315, 664, 894, 174, 340, 721, 492, 605, 96, 23, 463, 600, 966, 625, 844, 302, 771, 529, 152, 445, 321, 346, 628, 916, 93, 400, 158,
                             7, 458, 938, 902, 773, 677, 945, 620, 346, 833, 132, 529, 785, 139, 444, 484, 446, 441, 753, 453, 720, 891, 64, 195, 939, 581, 227, 244, 822, 990,
                             145, 822, 556, 458, 93, 82, 327, 896, 520, 955, 501, 111, 308, 564, 298, 723, 190, 982, 655, 533, 601, 669, 553, 895, 45, 99, 350, 708, 20, 335,
                             382, 380, 33, 866, 718, 463, 517, 299, 376, 920, 380, 94, 981, 874, 306, 967, 607, 438, 350, 110, 142, 29, 815, 541, 439, 275, 524, 554, 593, 947,
                             271, 243, 379, 767, 34, 67, 923, 995, 382, 164, 957, 519, 150, 310, 327, 26, 547, 846, 232, 652, 40, 879, 995, 36, 263, 771, 587, 606, 255, 196,
                             20, 691, 155, 672, 478, 856, 757, 380, 563, 964, 136, 260, 815, 945, 776, 197, 482, 212, 904, 213, 230, 701, 549, 372, 39, 516, 153, 545, 819, 292,
                             51, 180, 525, 279, 912, 436, 479, 985, 941, 641, 632, 370, 111, 390, 675, 385, 77, 452, 306, 374, 450, 345, 165, 826, 968, 113, 280, 650, 709, 455,
                             431, 770, 995, 862, 733, 237, 375, 742, 70, 113, 922, 936, 871, 284, 686, 776, 361, 658, 441, 509, 75, 778, 803, 950, 766, 236, 947, 273, 112, 442,
                             253, 326, 479, 160, 710, 233, 761, 953, 331, 610, 463, 386, 67, 761, 957, 934, 500, 588, 542, 633, 111, 950, 989, 232, 458, 474, 875, 764, 396, 213,
                             604, 355, 961, 481, 991, 510, 764, 637, 255, 812, 138, 964, 338, 711, 497, 879, 604, 937, 594, 828, 495, 671, 394, 343, 918, 312, 966, 429, 616, 833,
                             468, 424, 620, 203, 667, 44, 806, 162, 911, 712, 951, 365, 357, 1, 92, 850, 218, 710, 214, 797, 803, 671, 265, 264, 857, 214, 264, 998, 33, 103};  
// nie posortowana Lista wielkości n=1000
}

void RESET_COMP_ASS(){COMP = 0; ASS = 0;}
void PRINT_COMP_ASS(){std::cout << "\nCOMP = " << COMP << " ASS  = " << ASS << "\n"; RESET_COMP_ASS();}

void PRINT_VECTOR(std::vector<int>& A){
    for (int x : A) std::cout << x << " ";
    std::cout <<'\n';
}

void MERGE(std::vector<int>& A, int p, int s, int k){
    int n1 = s - p + 1; ASS++;
    int n2 = k - s; ASS++;

    std::vector<int> L(n1), R(n2); // puste listy o dł n1 / n2

    for (int i = 0; i < n1; i++) {
        L[i] = A[p + i]; ASS++;                      
    }
    for (int j = 0; j < n2; j++) {
        R[j] = A[s + 1 + j]; ASS++;                      
    }

    int i = 0, j = 0;
    for (int l = p; l <= k; l++) {
        if (i >= n1) {             
            A[l] = R[j++]; ASS++;                
        } 
        else if (j >= n2) {         
            A[l] = L[i++]; ASS++;                  
        } 
        else {
            COMP++;                 
            if (L[i] <= R[j]) {
                A[l] = L[i++]; ASS++;
            } else {
                A[l] = R[j++]; ASS++;
            }
        }
    }
}

void MERGE_SORT(std::vector<int>& A, int p, int k) {
    if (p < k){
        int s = (int)std::floor((p + k) / 2.0);
        MERGE_SORT(A, p, s);
        MERGE_SORT(A, s + 1, k);
        MERGE(A, p, s, k);
    }
}

void MERGE_MOD(std::vector<int>& A, int p, int s1, int s2, int k){
    int n1 = s1 - p + 1; ASS++;
    int n2 = s2 - s1;    ASS++;
    int n3 = k  - s2;    ASS++;

    std::vector<int> L(n1), M(n2), R(n3);
    for (int i2 = 0; i2 < n1; ++i2){ L[i2] = A[p + i2];       ASS++; }
    for (int j2 = 0; j2 < n2; ++j2){ M[j2] = A[s1 + 1 + j2];  ASS++; }
    for (int t2 = 0; t2 < n3; ++t2){ R[t2] = A[s2 + 1 + t2];  ASS++; }

    int i = 0, j = 0, t = 0; // wskaźniki do L, M, R
    int w = p;

    while (i < n1 || j < n2 || t < n3) {
        // jezeli wyczerpiemy wszystkie elementy z jednego ze zbiorów to not_empty_X == False
        bool not_empty_L = (i < n1);
        bool not_empty_M = (j < n2);
        bool not_empty_R = (t < n3);

        // 1)  wszystkie trzy listy mają elementy 
        if (not_empty_L && not_empty_M && not_empty_R) {
            COMP++;
            if (L[i] <= M[j]) {
                COMP++;
                if (L[i] <= R[t]) { A[w++] = L[i++]; ASS++; }
                else              { A[w++] = R[t++]; ASS++; }
            } else {
                COMP++;
                if (M[j] <= R[t]) { A[w++] = M[j++]; ASS++; }
                else              { A[w++] = R[t++]; ASS++; }
            }
            continue;
        }

        // 2) 1 lista pusta
        if (not_empty_L && not_empty_M) {
            COMP++;
            if (L[i] <= M[j]) { A[w++] = L[i++]; ASS++; }
            else               { A[w++] = M[j++]; ASS++; }
            continue;
        }

        if (not_empty_L && not_empty_R) {
            COMP++;
            if (L[i] <= R[t]) { A[w++] = L[i++]; ASS++; }
            else               { A[w++] = R[t++]; ASS++; }
            continue;
        }

        if (not_empty_M && not_empty_R) {
            COMP++;
            if (M[j] <= R[t]) { A[w++] = M[j++]; ASS++; }
            else               { A[w++] = R[t++]; ASS++; }
            continue;
        }

        // 3) 2 listy puste
        if (not_empty_L) { A[w++] = L[i++]; ASS++; continue; }
        if (not_empty_M) { A[w++] = M[j++]; ASS++; continue; }
        if (not_empty_R) { A[w++] = R[t++]; ASS++; continue; }
    }
}

void MERGE_SORT_MOD(std::vector<int>& A, int p, int k){
    if (p >= k) return;
    int s1 = floor(p + (k - p) / 3);
    int s2 = floor(p + 2 * (k - p) / 3);

    MERGE_SORT_MOD(A, p,      s1);
    MERGE_SORT_MOD(A, s1 + 1, s2);
    MERGE_SORT_MOD(A, s2 + 1, k);

    MERGE_MOD(A, p, s1, s2, k);
}

int main() {
    using namespace vectors_1;

    //MERGE_SORT(A7, 0, (int)A7.size() - 1);
    MERGE_SORT_MOD(A7, 0, (int)A7.size() - 1);
    //PRINT_VECTOR(A7);
    PRINT_COMP_ASS();

    //MERGE_SORT(A15, 0, (int)A15.size() - 1);
    MERGE_SORT_MOD(A15, 0, (int)A15.size() - 1);
    //PRINT_VECTOR(A15);
    PRINT_COMP_ASS();

    //MERGE_SORT(A100, 0, (int)A100.size() - 1);
    MERGE_SORT_MOD(A100, 0, (int)A100.size() - 1);
    //PRINT_VECTOR(A100);
    PRINT_COMP_ASS();

    //MERGE_SORT(A1000, 0, (int)A1000.size() - 1);
    MERGE_SORT_MOD(A1000, 0, (int)A1000.size() - 1);
    //PRINT_VECTOR(A1000);
    PRINT_COMP_ASS();
    
    return 0;
}
